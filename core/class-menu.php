<?php

namespace WPAudit\core;

use WPAudit\core\renderer\Settings;

if (!defined('ABSPATH')) {
    exit;
}


class Menu
{
    protected static $_instance = null;

    public static function admin_menu()
    {
        add_action('admin_menu', [self::instance(), 'register_menu']);
        add_action('admin_enqueue_scripts', [self::instance(), 'enqueue_scripts']);
    }

    /**
     *  Constructor.
     */
    public static function instance()
    {
        if (is_null(self::$_instance)) {
            self::$_instance = new self();
        }
        return self::$_instance;
    }

    public function enqueue_scripts($hook)
    {
        if ($hook != 'toplevel_page_wp-audit') {
            return;
        }
        wp_enqueue_style('wpaudit-style', get_wpaudit_asset_uri('/assets/css/wpaudit.min.css'), array(), wpaudit_version(), 'all');
        wp_enqueue_script('wpaudit-script', get_wpaudit_asset_uri('/assets/js/wpaudit.min.js'), array('jquery'), wpaudit_version(), 'all');
        $localized_data = array(
            'ajax_url' => admin_url('admin-ajax.php'),
        );
        wp_localize_script('wpaudit-script', 'wpaudit', $localized_data);
    }

    public function register_menu()
    {
        add_menu_page(
            'WPAudit',
            'WPAudit',
            'edit_plugins',
            'wp-audit',
            [$this, 'render_settings'],
            'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNzQuOTE3IiBoZWlnaHQ9IjE2NCIgdmlld0JveD0iMCAwIDE3NC45MTcgMTY0Ij4KICAgIDxnIGlkPSJsb2dvLWZ1bGwtc21hbGwiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC03MjguNTA4IC03ODYuODU3KSI+CiAgICAgICAgPHBhdGggaWQ9IlBhdGhfMzAiCiAgICAgICAgICAgICAgZmlsbD0iI2ZmZiIKICAgICAgICAgICAgICBkYXRhLW5hbWU9IlBhdGggMzAiIGQ9Ik0tMzY5MS45MTgtMTU5MS42NDNhNy41LDcuNSwwLDAsMS0zLjMzNC0uNzg3LDE2NC41LDE2NC41LDAsMCwxLTMxLjM5My0yMS41NTcsMTEyLjM1MSwxMTIuMzUxLDAsMCwxLTIxLjkzOS0yNS4yMzJjLTYuOTE4LTExLjI0LTEwLjQyNi0yMi44MjItMTAuNDI2LTM0LjQyNHYtNTIuMTgyYTcuNDE2LDcuNDE2LDAsMCwxLDEuMzI4LTQuMjQ2LDcuNDE0LDcuNDE0LDAsMCwxLDMuNTEtMi43MzRsNTkuNjM2LTIyLjM2NGE3LjQxNyw3LjQxNywwLDAsMSwyLjYxNy0uNDc0LDcuNDM1LDcuNDM1LDAsMCwxLDIuNjE4LjQ3NGw1OS42MzUsMjIuMzY0YTcuNDE5LDcuNDE5LDAsMCwxLDMuNTEsMi43MzQsNy40MjMsNy40MjMsMCwwLDEsMS4zMjcsNC4yNDZ2NTIuMTgyYTYzLjI3NSw2My4yNzUsMCwwLDEtNy40NjUsMjkuMnYtMzUuNDQ3aC05LjYyOXYxNi4zYTExLjU0MywxMS41NDMsMCwwLDAtMy45NC0yLjE4OSwxNS45MDksMTUuOTA5LDAsMCwwLTUuMDMzLS43NjYsMTQuODQsMTQuODQsMCwwLDAtNy4zLDEuNzUxLDEyLjM1OSwxMi4zNTksMCwwLDAtNC45LDQuOTUxLDE1LjA0NywxNS4wNDcsMCwwLDAtMS43NTEsNy4zLDE0Ljg0NSwxNC44NDUsMCwwLDAsMS43NTEsNy4zLDEyLjIyNywxMi4yMjcsMCwwLDAsNC45MjQsNC44NjksMTUuMDcxLDE1LjA3MSwwLDAsMCw3LjI3NiwxLjcyNCwxMy4wOTIsMTMuMDkyLDAsMCwwLDkuMy0zLjQ0N3YyLjYyNmg2LjQ5MmwtLjEyNS4yLS4wMjQuMDRhMTEyLjM3NiwxMTIuMzc2LDAsMCwxLTIxLjk0MiwyNS4yMzIsMTY0LjYxOSwxNjQuNjE5LDAsMCwxLTMxLjM5MywyMS41NTdBNy41LDcuNSwwLDAsMS0zNjkxLjkxOC0xNTkxLjY0M1ptLTYuMDI2LTc0LjA4MXYxNi4xMzlhMTEuNDU3LDExLjQ1NywwLDAsMCwyLjcwOCw3LjkzM2MxLjgsMiw0LjUyOSwzLjAwOSw4LjEyNSwzLjAwOWExMy45MTIsMTMuOTEyLDAsMCwwLDUuMDMzLS45MywxMS4wMDgsMTEuMDA4LDAsMCwwLDQuMS0yLjczNnYyLjg0NWg5LjN2LTI2LjI2MWgtOS42Mjh2MTYuMTM5YTYuODUzLDYuODUzLDAsMCwxLTIuNTE3LDIuNTcyLDYuNzQ5LDYuNzQ5LDAsMCwxLTMuMzkzLjg3NSwzLjk1NiwzLjk1NiwwLDAsMS0zLjA3Ny0xLjEzNSw0Ljk2MSw0Ljk2MSwwLDAsMS0xLjAyNi0zLjQwNnYtMTUuMDQ1Wm0tMjEuOTM4LDguODYzYy0zLjYzMSwwLTYuNDU2LjgtOC40LDIuMzhhOC4zMDgsOC4zMDgsMCwwLDAtMi45MjcsNi44MTEsOCw4LDAsMCwwLDMuMDM3LDYuNjQ3LDEyLjU5MSwxMi41OTEsMCwwLDAsNy45NiwyLjM4LDE0Ljk4LDE0Ljk4LDAsMCwwLDUuMTQyLS44MjEsMTAuNTExLDEwLjUxMSwwLDAsMCwzLjcyMS0yLjI0M3YyLjI0M2g5LjAyN3YtMTUuOTc1YTkuODI3LDkuODI3LDAsMCwwLTMuNzQ4LTguMTc5Yy0yLjQ4Ny0xLjk0Mi02LjIxNC0yLjkyNy0xMS4wNzgtMi45MjdhMzMuMDA2LDMzLjAwNiwwLDAsMC01LjkwOS41MiwxOS4yNjEsMTkuMjYxLDAsMCwwLTQuNiwxLjM0djYuNjJhMjAuNzA2LDIwLjcwNiwwLDAsMSw4LjgwOS0xLjg2LDEwLjE0MSwxMC4xNDEsMCwwLDEsNS4xNywxLjA1MywzLjQ3NywzLjQ3NywwLDAsMSwxLjcyMywzLjE2di41NDdhMTUuNzkzLDE1Ljc5MywwLDAsMC0zLjY2Ni0xLjIzMUEyMC4wNDcsMjAuMDQ3LDAsMCwwLTM3MTkuODgzLTE2NTYuODYxWm0zNS4wMTYtNTIuOTYxdjM4LjI0Mmg5LjYyOHYtMTQuMTE1YTExLjY3NiwxMS42NzYsMCwwLDAsMy45NjcsMi4xNiwxNS43ODYsMTUuNzg2LDAsMCwwLDUuMDA2Ljc5MywxNC44MzcsMTQuODM3LDAsMCwwLDcuMy0xLjc1LDEyLjM2NywxMi4zNjcsMCwwLDAsNC45LTQuOTUyLDE1LjA0MiwxNS4wNDIsMCwwLDAsMS43NS03LjMsMTQuODQxLDE0Ljg0MSwwLDAsMC0xLjc1LTcuMywxMi4yMTksMTIuMjE5LDAsMCwwLTQuOTI0LTQuODY5LDE1LjA2MSwxNS4wNjEsMCwwLDAtNy4yNzYtMS43MjQsMTMuMSwxMy4xLDAsMCwwLTkuMywzLjQ0NnYtMi42MjVabS00Ni4zNCwwLDguODA4LDI2LjI2aDguNjQ0bDQuNDg2LTE0Ljc2OHYwbDQuNDg0LDE0Ljc2OWg4LjY0NGw4LjgwOS0yNi4yNmgtOS42MjlsLTQuMjE0LDE1LjA0NS00LjIxMi0xNS4wNDVoLTcuNzY5bC00LjIxMSwxNS4wNDUtNC4yMTMtMTUuMDQ1Wm0xNDAuMTEyLDcxLjE3OWMtMy4yMzEsMC01LjcwNy0uOTExLTcuMzU4LTIuNzA4YTEwLjU4MywxMC41ODMsMCwwLDEtMi40OS03LjQxM3YtMTAuMjg2aC0zLjcyMXYtNi42NzRoMy43MjF2LTcuODc4aDkuNjI5djcuODc4aDYuMDE4djYuNjc0aC02LjAxOHY4Ljk3M2E0LjczNyw0LjczNywwLDAsMCwuNzkyLDMuMDY0LDMuNTc2LDMuNTc2LDAsMCwwLDIuODE4LjkzLDcuNTE4LDcuNTE4LDAsMCwwLDMuNjExLS45ODV2Ny4xNjdhMTIuODk0LDEyLjg5NCwwLDAsMS0zLjAzNy45NThBMjIuMTYzLDIyLjE2MywwLDAsMS0zNTkxLjA5NS0xNjM4LjY0MlptLTE2LjYzMi0uODIxaC05LjYyOXYtMjYuMjYxaDkuNjI5djI2LjI2Wm0tMTcuMjg4LDBhMy4zOCwzLjM4LDAsMCwxLTIuNDM1LS45ODUsMy4yNDYsMy4yNDYsMCwwLDEtMS4wMTItMi40MDcsMy40ODksMy40ODksMCwwLDEsMS4wMTItMi41MTYsMy4yODksMy4yODksMCwwLDEsMi40MzUtMS4wNCwzLjM1NSwzLjM1NSwwLDAsMSwyLjQ5LDEuMDQsMy40ODcsMy40ODcsMCwwLDEsMS4wMTEsMi41MTYsMy4yNDUsMy4yNDUsMCwwLDEtMS4wMTEsMi40MDdBMy40NSwzLjQ1LDAsMCwxLTM2MjUuMDE1LTE2MzkuNDYzWm0tNy4yNzYsMGgtMi44MDljMS0xLjY0LDEuOTQ3LTMuMzE2LDIuODA5LTQuOTgzdjQuOTgyWm0tODUuMDc0LTUuMDg4YTQuNTcsNC41NywwLDAsMS0yLjkyNy0uODIxLDIuOCwyLjgsMCwwLDEtMS4wMTItMi4zLDIuOSwyLjksMCwwLDEsMS4wNC0yLjQwOCw0LjY5MSw0LjY5MSwwLDAsMSwyLjk1NC0uODIxLDkuNDExLDkuNDExLDAsMCwxLDUuMzYyLDEuNTg3djIuM2E1LjQ3OSw1LjQ3OSwwLDAsMS0yLjI0MywxLjc3OEE3LjUsNy41LDAsMCwxLTM3MTcuMzY1LTE2NDQuNTUxWm02OC45ODktMS41MzJhNi42MzcsNi42MzcsMCwwLDEtNC43Ni0xLjcyNCw2LjI2MSw2LjI2MSwwLDAsMS0xLjgtNC43MzIsNi4zNTIsNi4zNTIsMCwwLDEsMS44LTQuNzYsNi41NzgsNi41NzgsMCwwLDEsNC43Ni0xLjc1MSw3LjE4MSw3LjE4MSwwLDAsMSwzLjkzOCwxLjEyMiw2LjMzOSw2LjMzOSwwLDAsMSwyLjUxNywzLjAzN3Y0LjY1YTYuMzQxLDYuMzQxLDAsMCwxLTIuNTE3LDMuMDM3QTcuMTgxLDcuMTgxLDAsMCwxLTM2NDguMzc2LTE2NDYuMDgzWm0zNS44MzQtMjMuMTQyYTUuMSw1LjEsMCwwLDEtMy42NjUtMS40MjMsNC44MTksNC44MTksMCwwLDEtMS40NzctMy42MTEsNC44NCw0Ljg0LDAsMCwxLDEuNDc3LTMuNTgzLDUuMDQ2LDUuMDQ2LDAsMCwxLDMuNjY1LTEuNDUsNS4wNzMsNS4wNzMsMCwwLDEsMy42MzksMS40NSw0LjgsNC44LDAsMCwxLDEuNSwzLjU4Myw0LjgsNC44LDAsMCwxLTEuNSwzLjU4NEE1LjA3NSw1LjA3NSwwLDAsMS0zNjEyLjU0Mi0xNjY5LjIyNVptLTU2LjI0Mi0yMS4wMTFhNy4xNzUsNy4xNzUsMCwwLDEtMy45MzktMS4xMjIsNi4zMzYsNi4zMzYsMCwwLDEtMi41MTYtMy4wMzZ2LTQuNjUxYTYuMzM3LDYuMzM3LDAsMCwxLDIuNTE2LTMuMDM2LDcuMTc2LDcuMTc2LDAsMCwxLDMuOTM5LTEuMTIyLDYuNjMsNi42MywwLDAsMSw0Ljc2LDEuNzI0LDYuMjU0LDYuMjU0LDAsMCwxLDEuODA2LDQuNzMyLDYuMzQ4LDYuMzQ4LDAsMCwxLTEuODA2LDQuNzZBNi41NzQsNi41NzQsMCwwLDEtMzY2OC43ODQtMTY5MC4yMzZaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg0NDg3LjUxOCAyNTQyLjUpIi8+CiAgICA8L2c+Cjwvc3ZnPg==',
            66
        );
    }

    public function render_settings()
    {
        Settings::instance()->render();
    }
}
